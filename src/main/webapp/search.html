<html lang="zh">
<head>
    <meta charset="utf-8"/>
    <title>橙办</title>
    <link rel="stylesheet" type="text/css" href="layUI/css/layui.css"/>
    <link rel="stylesheet" type="text/css" href="css/all.css"/>
    <link rel="stylesheet" type="text/css" href="css/search.css"/>
    <script src="js/jquery-1.12.0.min.js" type="text/javascript" charset="utf-8"></script>
    <script src="layUI/layui.js" type="text/javascript" charset="utf-8"></script>
    <script src="js/utils.js" type="text/javascript" charset="utf-8"></script>
</head>

<!-- 美洽客服 -->
<script title="text/javascript">
    (function (m, ei, q, i, a, j, s) {
        m[i] = m[i] || function () {
            (m[i].a = m[i].a || []).push(arguments)
        };
        j = ei.createElement(q);
        s = ei.getElementsByTagName(q)[0];
        j.async = true;
        j.charset = 'UTF-8';
        j.src = 'https://static.meiqia.com/dist/meiqia.js?=_t';
        s.parentNode.insertBefore(j, s);
    })(window, document, 'script', '_MEIQIA');
    _MEIQIA('entId', 51778);
</script>

<script type="text/javascript">
    let keyword;
    let filter = {};
    let pageIndex = 0;
    let pageNum = 0;

    window.onload = function () {
        let request = window.location.search;
        keyword = http.getParameter(request, "keyword");
        if (keyword) {
            keyword = decodeURI(keyword);
            document.getElementById("keyword_input").setAttribute("value", keyword);
        }
        filter.checkedDistrictId = http.getParameter(request, "district_id");
        filter.checkedZoneId = http.getParameter(request, "zone_id");
        filter.checkedMetroId = http.getParameter(request, "metro_id");
        filter.checkedTypeId = http.getParameter(request, "type_id");
        filter.checkedAreaRangeId = http.getParameter(request, "area_range_id");
        filter.checkedPriceRangeId = http.getParameter(request, "price_range_id");
        filter.checkedDecorationId = http.getParameter(request, "decoration_id");
        getFilterList();
        getHotList();
    };

    function getFilterList() {
        http.post({
            url: "filter/all",
            params: {
                district_id: filter.checkedDistrictId,
                zone_id: filter.checkedZoneId,
                metro_id: filter.checkedMetroId,
                type_id: filter.checkedTypeId,
                area_range_id: filter.checkedAreaRangeId,
                price_range_id: filter.checkedPriceRangeId,
                decoration_id: filter.checkedDecorationId,
            },
            success: function (data) {
                filter = data;
                getBuildingList();
            }
        });
    }

    function getBuildingList(page) {
        http.post({
            url: "search/buildings",
            params: {
                keyword: keyword,
                district_id: filter.checkedDistrictId,
                zone_id: filter.checkedZoneId,
                metro_id: filter.checkedMetroId,
                type_id: filter.checkedTypeId,
                area_range_id: filter.checkedAreaRangeId,
                price_range_id: filter.checkedPriceRangeId,
                decoration_id: filter.checkedDecorationId,
                page: page,
            },
            success: function (data) {
                filter.checkedDistrictId = data.checkedDistrictId;
                filter.checkedZoneId = data.checkedZoneId;
                filter.checkedMetroId = data.checkedMetroId;
                filter.checkedTypeId = data.checkedTypeId;
                filter.checkedAreaRangeId = data.checkedAreaRangeId;
                filter.checkedPriceRangeId = data.checkedPriceRangeId;
                filter.checkedDecorationId = data.checkedDecorationId;
                setFilterList();
                pageIndex = data.pageIndex;
                pageNum = data.pageNum;
                setBuildingList(data.buildingList);
            },
        });
    }

    function setFilterList() {
        if (!filter) {
            return;
        }
        setFilterListByName(filter.districtList, 'districtList', filter.checkedDistrictId);
        let zoneList = filter.districtList[filter.checkedDistrictId - 1].zoneList;
        setFilterListByName(zoneList, 'zoneList', filter.checkedZoneId);
        setFilterListByName(filter.metroList, 'metroList', filter.checkedMetroId);
        setFilterListByName(filter.typeList, 'typeList', filter.checkedTypeId);
        setFilterListByName(filter.areaRangeList, 'areaRangeList', filter.checkedAreaRangeId);
        setFilterListByName(filter.priceRangeList, 'priceRangeList', filter.checkedPriceRangeId);
        setFilterListByName(filter.decorationList, 'decorationList', filter.checkedDecorationId);
    }

    function setFilterListByName(list, name, checkedId) {
        if (!list || list.length < 2) {
            $("#" + name.substr(0, name.length - 4)).hide();
        } else {
            $("#" + name.substr(0, name.length - 4)).show();
        }
        let conditionBox = document.getElementById(name);
        if (conditionBox == null) {
            return
        }
        conditionBox.innerHTML = "";
        for (let i = 0; list && i < list.length; i++) {
            let optionItem = document.createElement("span");
            if (list[i].id === checkedId) {
                optionItem.className = 'condition_option_select';
            } else {
                optionItem.className = 'condition_option';
            }
            optionItem.innerHTML = list[i].name;
            optionItem.onclick = function () {
                switch (name) {
                    case "districtList":
                        filter.checkedDistrictId = list[i].id;
                        break;
                    case "zoneList":
                        filter.checkedZoneId = list[i].id;
                        break;
                    case "metroList":
                        filter.checkedMetroId = list[i].id;
                        break;
                    case "typeList":
                        filter.checkedTypeId = list[i].id;
                        break;
                    case "areaRangeList":
                        filter.checkedAreaRangeId = list[i].id;
                        break;
                    case "priceRangeList":
                        filter.checkedPriceRangeId = list[i].id;
                        break;
                    case "decorationList":
                        filter.checkedDecorationId = list[i].id;
                        break;
                }
                getBuildingList();
            };
            conditionBox.appendChild(optionItem);
        }
    }

    function setBuildingList(buildingList) {
        let dataListBox = document.getElementById("data_list_box");
        if (pageIndex === 0) {
            dataListBox.innerHTML = "";
        }
        if (pageNum > pageIndex + 1) {
            $("#next_page").show();
        } else {
            $("#next_page").hide();
        }
        if (pageIndex === 0 && buildingList.length === 0) {
            $("#error_not_text").show();
        } else {
            $("#error_not_text").hide();
        }

        for (let i = 0; i < buildingList.length; i++) {
            let building = buildingList[i];

            let row = document.createElement("div");
            row.className = 'building_item';
            dataListBox.appendChild(row);

            let imgLeft = document.createElement("img");
            imgLeft.className = 'item_image clickable';
            imgLeft.setAttribute("src", building.img_list[0]);
            imgLeft.onclick = function () {
                openDetail(building.id);
            };
            row.appendChild(imgLeft);

            let conditionBox = document.createElement("div");
            conditionBox.className = "data_item_box flex_column_left";
            row.appendChild(conditionBox);

            let dataInfoBox = document.createElement("div");
            dataInfoBox.className = 'data_info_box flex_column';
            conditionBox.appendChild(dataInfoBox);

            let itemName = document.createElement("div");
            itemName.className = 'item_name clickable';
            itemName.innerHTML = building.name;
            itemName.onclick = function () {
                openDetail(building.id);
            };
            dataInfoBox.appendChild(itemName);

            let itemAddress = document.createElement("div");
            itemAddress.className = 'item_address';
            let item_title = document.createElement("span");
            item_title.innerHTML = "地址：";
            let district_name = document.createElement("a");
            district_name.className = "hover_de clickable";
            district_name.innerHTML = building.district_name;
            district_name.onclick = function () {
                window.open("search.html?district_id=" + building.district_id);
            };
            let zone_name = document.createElement("a");
            zone_name.className = "hover_de clickable";
            zone_name.innerHTML = building.zone_name;
            zone_name.onclick = function () {
                window.open("search.html?district_id=" + building.district_id
                    + "&zone_id=" + building.zone_id
                );
            };
            itemAddress.appendChild(item_title);
            itemAddress.append("[ ");
            itemAddress.appendChild(district_name);
            itemAddress.append(" ] - [ ");
            itemAddress.appendChild(zone_name);
            itemAddress.append(" ]     |      " + building.address);
            dataInfoBox.appendChild(itemAddress);
            //
            // let itemSize = document.createElement("div");
            // itemSize.className = 'item_size item_margin';
            // dataInfoBox.appendChild(itemSize);
            //
            // itemSize.innerHTML = "<span class=\"item_title\">面积：</span>" + building.area_range + "m²";
            //
            // let itemPosition = document.createElement("div");
            // itemPosition.className = 'item_position item_margin';
            // itemPosition.innerHTML = "共有" + building.office_num + "个房源";
            // dataInfoBox.appendChild(itemPosition);

            let buildingInfoBox = document.createElement("div");
            buildingInfoBox.className = "building_info_box";
            buildingInfoBox.innerHTML = "<span class='building_info_title'>大厦简介：</span>" + building.introduce;
            dataInfoBox.appendChild(buildingInfoBox);

            let itemSizeBtnBox = document.createElement("div");
            itemSizeBtnBox.className = 'item_size_btn_box flex_row';
            dataInfoBox.appendChild(itemSizeBtnBox);

            for (let j = 0; j < building.area_list.length && j < 4; j++) {
                let itemSizeBtn = document.createElement("div");
                itemSizeBtn.className = 'item_size_btn hover_de clickable';
                itemSizeBtn.innerHTML = building.area_list[j] + "m²"; // -----------------------
                itemSizeBtnBox.appendChild(itemSizeBtn);
                itemSizeBtn.onclick = function () {
                    openDetail(building.id);
                }
            }

            let itemPrice = document.createElement("div");
            itemPrice.className = 'item_price';
            itemPrice.innerHTML = "<span class=\"item_price_num\">" +
                building.price_average + // -----------------------
                "</span>元/m²/天 起";
            dataInfoBox.appendChild(itemPrice);

            let btn = document.createElement("div");
            btn.onclick = function () {
                openDetail(building.id);
            };
            btn.className = 'item_btn';
            btn.innerHTML = "了解更多";
            dataInfoBox.appendChild(btn);
        }
        loadPageUtil(buildingList.length);
    }

    function nextPage() {
        getBuildingList(pageIndex + 1);
    }

    function search() {
        let searchInput = document.getElementById("top_search");
        keyword = searchInput.value;
        getBuildingList();
    }

    function openDetail(building_id) {
        window.open("buildingDetail.html?building_id=" + building_id, "_blank");
    }

    function getHotList() {
        http.post({
            url: "news/hot",
            success: function (data) {
                setHeatNews(data);
            }
        })
    }

    /**
     * 设置资讯
     * @param heatNewsList
     */
    function setHeatNews(heatNewsList) {
        if (heatNewsList == null) return;
        let ListBox = document.getElementById("right_heat_news");
        for (let i = 0, len = heatNewsList.length; i < len; i++) {
            let itemBox = document.createElement("div");
            itemBox.className = "right_heat_news_item";

            let imgListStr = heatNewsList[i].img_list;
            let imgList = JSON.parse(imgListStr);
            let itemImg = document.createElement("img");
            itemImg.className = "right_heat_news_img";
            if (imgList && imgList.length > 0) {
                utils.setImageSrc(itemImg, imgList[0]);
            } else {
                utils.setImageSrc(itemImg, null);
            }
            itemBox.appendChild(itemImg);

            let itemInfo = document.createElement("div");
            itemInfo.className = "right_heat_news flex_column_left";

            let itemTitle = document.createElement("div");
            itemTitle.className = "right_heat_news_title";
            itemTitle.innerHTML = heatNewsList[i].title;
            itemTitle.onclick = function () {
                window.open("newsDetail.html?news_id=" + heatNewsList[i].id);
            };
            itemInfo.appendChild(itemTitle);

            let itemTime = document.createElement("div");
            itemTime.className = "right_heat_news_time";
            itemTime.innerHTML = heatNewsList[i].last_edit_time;
            itemInfo.appendChild(itemTime);

            if (i === len - 1) {
                itemBox.setAttribute("style", "border: none;");
            }

            itemBox.appendChild(itemInfo);
            ListBox.appendChild(itemBox);
        }
    }

    //
    // /**
    //  * 设置资讯
    //  * @param heatBuildingList
    //  */
    // function setHeatBuilding(heatBuildingList) {
    //     if (heatBuildingList == null) return;
    //     let ListBox = document.getElementById("right_heat_building");
    //     for (let i = 0, len = heatBuildingList.length; i < len; i++) {
    //         let itemBox = document.createElement("div");
    //         itemBox.className = "right_heat_building_item";
    //         itemBox.innerHTML = "<span class='right_heat_mark'>&gt;</span>&nbsp;&nbsp;" + heatBuildingList[i].name;
    //         ListBox.appendChild(itemBox);
    //     }
    // }

    /**
     * 加载分页工具
     * @param dataSize 数据总数
     */
    function loadPageUtil(dataSize) {
        layui.use('laypage', function () {
            var laypage = layui.laypage;
            //执行一个laypage实例
            laypage.render({
                //注意，这里的 test1 是 ID，不用加 # 号
                elem: 'page_box',
                //数据总数，从服务端得到
                count: dataSize,
                limit: 10,
                jump: function (obj, first) {
                    //obj包含了当前分页的所有参数，比如：
                    // console.log(obj.curr); //得到当前页，以便向服务端请求对应页的数据。
                    // console.log(obj.limit); //得到每页显示的条数

                    //首次不执行
                    if (!first) {
                        getBuildingList(obj.curr - 1);
                    }
                }
            });
        });
    }
</script>

<body>
<div class="title_box">
    <div class="win flex_row position_relative">
        <div class="top_logo"></div>
        <div class="position_right">
            <div class="title_text_right">
                <a href="index.html" class="clickable">首页</a>
            </div>
            <div class="title_text_right title_obvious">
                <a href="search.html" class="clickable">写字楼出租</a>
            </div>
            <div class="title_text_right">
                <a href="search.html?type_id=3" class="clickable">共享办公</a>
            </div>
            <div class="title_text_right">
                <a href="news.html" class="clickable">资讯中心</a>
            </div>
            <div class="icon_phone"></div>
            <div class="title_text_right">
                <span class="tel_num">4008-700-758</span>
            </div>
        </div>
    </div>
</div>

<div class="matop bg_white">
    <div class="condition_box flex_column" id="condition_box">
        <div class="win condition_line gradient_line_50">
            <div class="win flex_row">
                <div class="condition_title" id="district">
                    区：
                </div>
                <div class="option_box flex_row" id="districtList">
                </div>
            </div>
        </div>
        <div class="win condition_line gradient_line_55" id="zone" style="display: none;">
            <div class="win flex_row">
                <div class="condition_title">
                    区域：
                </div>
                <div class="option_box flex_row" id="zoneList">
                </div>
            </div>
        </div>
        <div class="win condition_line gradient_line_60" id="metro">
            <div class="win flex_row">
                <div class="condition_title">
                    地铁：
                </div>
                <div class="option_box flex_row" id="metroList">
                </div>
            </div>
        </div>
        <div class="win condition_line gradient_line_65" id="type">
            <div class="win flex_row">
                <div class="condition_title">
                    类型：
                </div>
                <div class="option_box flex_row" id="typeList">
                </div>
            </div>
        </div>
        <div class="win condition_line gradient_line_70" id="areaRange">
            <div class="win flex_row">
                <div class="condition_title">
                    面积：
                </div>
                <div class="option_box flex_row" id="areaRangeList">
                </div>
            </div>
        </div>
        <div class="win condition_line gradient_line_75" id="priceRange">
            <div class="win flex_row">
                <div class="condition_title">
                    价格：
                </div>
                <div class="option_box flex_row" id="priceRangeList">
                </div>
            </div>
        </div>
        <div class="win condition_line gradient_line_80" id="decoration">
            <div class="win flex_row">
                <div class="condition_title">
                    装修：
                </div>
                <div class="option_box flex_row" id="decorationList">
                </div>
            </div>
        </div>
    </div>
</div>

<div class="content_box matop win flex_row">
    <div class="content_left bg_white">
        <div class="error_not_text" id="error_not_text">
            抱歉，暂无数据！
        </div>

        <div class="data_list flex_column_left" id="data_list_box">
            <div class="data_item_box flex_row" id="dataList">
            </div>
        </div>

        <div class="page_box" id="page_box">
        </div>
    </div>
    <div class="content_right bg_white">
        <form action="search.html">
            <div class="right_search_box">
                <input type="text" id="keyword_input" class="right_search" name="keyword" placeholder="在这里输入您想了解的写字楼"/>
                <input class="right_search_btn" type="submit" value=" "/>
            </div>
        </form>

        <!--        <div class="right_item_box">-->
        <!--            <div class="right_item_title_red">热门写字楼</div>-->
        <!--            <div class="flex_column_left" id="right_heat_building">-->
        <!--            </div>-->
        <!--        </div>-->

        <div class="right_item_box">
            <div class="right_item_title_green">近期资讯</div>
            <div class="flex_column_left" id="right_heat_news">
            </div>
        </div>
    </div>
</div>

<div class="bottom_box flex_column_left">
    <div class="win flex_column_left">
        <span class="friendly_href_sign">&nbsp;|&nbsp;&nbsp;&nbsp;友情链接</span>

        <div class="friendly_href">
            <a href="https://sh.diandianzu.com/" target="_blank">上海办公室出租</a>
            <a href="https://sh.diandianzu.com/" target="_blank">上海办公室出租</a>
            <a href="https://sh.diandianzu.com/" target="_blank">上海办公室出租</a>
        </div>

        <div class="foot_logo flex_row">
            <div class="bottom_logo"></div>
            <span>&nbsp;&nbsp;&nbsp;办公选址 心想事成！</span>
        </div>

        <div class="foot_contact_info flex_column_left">
            <span>24h 400电话：400-8700-758</span>
        </div>
    </div>
</div>
</body>
</html>