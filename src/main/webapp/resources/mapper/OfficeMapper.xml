<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<!--suppress ALL -->
<mapper namespace="cn.ddzu.shop.dao.OfficeMapperDao">

    <insert id="insertOffice" parameterType="cn.ddzu.shop.entity.Office">
        INSERT INTO OFFICE VALUES (
            NULL
            ,#{office.name}
            ,#{office.building_id}
            ,#{office.address}
            ,#{office.type_id}
            ,#{office.area}
            ,#{office.area_range_id}
            ,#{office.price}
            ,#{office.price_range_id}
            ,#{office.decoration_id}
            ,#{office.utilization_rate}
            ,#{office.can_register}
            ,#{office.rent_free_period}
            ,#{office.notes}
            ,#{office.img_list}
        );
    </insert>

    <select id="selectOfficeById" parameterType="java.lang.Long" resultType="cn.ddzu.shop.entity.Office">
        SELECT
        OFFICE.ID,
        OFFICE.NAME,
        OFFICE.BUILDING_ID,
        OFFICE.ADDRESS,
        OFFICE.TYPE_ID,
        OFFICE.AREA,
        OFFICE.AREA_RANGE_ID,
        OFFICE.PRICE,
        OFFICE.PRICE_RANGE_ID,
        OFFICE.DECORATION_ID,
        OFFICE.UTILIZATION_RATE,
        OFFICE.CAN_REGISTER,
        OFFICE.RENT_FREE_PERIOD,
        OFFICE.NOTES,
        OFFICE.IMG_LIST,
        TYPE.NAME AS TYPE_NAME,
        AREA_RANGE.NAME AS AREA_RANGE_NAME,
        PRICE_RANGE.NAME AS PRICE_RANGE_NAME,
        DECORATION.NAME AS DECORATION_NAME
        FROM OFFICE
        LEFT JOIN TYPE ON OFFICE.TYPE_ID = TYPE.ID
        LEFT JOIN AREA_RANGE ON OFFICE.AREA_RANGE_ID = AREA_RANGE.ID
        LEFT JOIN PRICE_RANGE ON OFFICE.PRICE_RANGE_ID = PRICE_RANGE.ID
        LEFT JOIN DECORATION ON OFFICE.DECORATION_ID = DECORATION.ID
        WHERE OFFICE.ID = #{id};
    </select>

    <select id="selectOfficeList" resultType="cn.ddzu.shop.entity.Office">
        SELECT
        OFFICE.ID,
        OFFICE.NAME,
        OFFICE.BUILDING_ID,
        OFFICE.ADDRESS,
        OFFICE.TYPE_ID,
        OFFICE.AREA,
        OFFICE.AREA_RANGE_ID,
        OFFICE.PRICE,
        OFFICE.PRICE_RANGE_ID,
        OFFICE.DECORATION_ID,
        OFFICE.UTILIZATION_RATE,
        OFFICE.CAN_REGISTER,
        OFFICE.RENT_FREE_PERIOD,
        OFFICE.NOTES,
        OFFICE.IMG_LIST,
        DISTRICT.NAME AS DISTRICT_NAME,
        ZONE.NAME AS ZONE_NAME,
        TYPE.NAME AS TYPE_NAME,
        AREA_RANGE.NAME AS AREA_RANGE_NAME,
        PRICE_RANGE.NAME AS PRICE_RANGE_NAME,
        DECORATION.NAME AS DECORATION_NAME
        FROM OFFICE
        LEFT JOIN BUILDING ON OFFICE.BUILDING_ID = BUILDING.ID
        LEFT JOIN ZONE ON BUILDING.ZONE_ID = ZONE.ID
        LEFT JOIN DISTRICT ON ZONE.DISTRICT_ID = DISTRICT.ID
        LEFT JOIN TYPE ON OFFICE.TYPE_ID = TYPE.ID
        LEFT JOIN AREA_RANGE ON OFFICE.AREA_RANGE_ID = AREA_RANGE.ID
        LEFT JOIN PRICE_RANGE ON OFFICE.PRICE_RANGE_ID = PRICE_RANGE.ID
        LEFT JOIN DECORATION ON OFFICE.DECORATION_ID = DECORATION.ID
        <where>
            <if test="keyword != null">
                AND OFFICE.NAME LIKE #{keyword}
            </if>
            <if test="building_id != null">
                AND OFFICE.BUILDING_ID = #{building_id}
            </if>
            <if test="metro_name != null">
                AND BUILDING.METRO_NAME_LIST LIKE #{metro_name}
            </if>
            <if test="type_id != null">
                AND OFFICE.TYPE_ID = #{type_id}
            </if>
            <if test="area_range_id != null">
                AND OFFICE.AREA_RANGE_ID = #{area_range_id}
            </if>
            <if test="price_range_id != null">
                AND OFFICE.PRICE_RANGE_ID = #{price_range_id}
            </if>
            <if test="decoration_id != null">
                AND OFFICE.DECORATION_ID = #{decoration_id}
            </if>
            <if test="district_id == zone_id">
                AND BUILDING.ZONE_ID IN
                (SELECT ZONE.ID
                FROM ZONE
                <if test="district_id != null">
                    WHERE DISTRICT_ID = #{district_id}
                </if>
                )
            </if>
            <if test="district_id != zone_id">
                AND BUILDING.ZONE_ID = #{zone_id}
            </if>
        </where>
        ORDER BY OFFICE.ID DESC
        <if test="step > 0">
            LIMIT #{start}, #{step};
        </if>
    </select>

    <select id="countOfficeList" resultType="java.lang.Integer">
        SELECT COUNT(*) FROM OFFICE
        LEFT JOIN BUILDING ON OFFICE.BUILDING_ID = BUILDING.ID
        <where>
            <if test="keyword != null">
                AND OFFICE.NAME LIKE #{keyword}
            </if>
            <if test="building_id != null">
                AND OFFICE.BUILDING_ID = #{building_id}
            </if>
            <if test="metro_name != null">
                AND OFFICE.METRO_NAME_LIST LIKE #{metro_name}
            </if>
            <if test="type_id != null">
                AND OFFICE.TYPE_ID = #{type_id}
            </if>
            <if test="area_range_id != null">
                AND OFFICE.AREA_RANGE_ID = #{area_range_id}
            </if>
            <if test="price_range_id != null">
                AND OFFICE.PRICE_RANGE_ID = #{price_range_id}
            </if>
            <if test="decoration_id != null">
                AND OFFICE.DECORATION_ID = #{decoration_id}
            </if>
            <if test="district_id == zone_id">
                AND BUILDING.ZONE_ID IN
                (SELECT ZONE.ID
                FROM ZONE
                <if test="district_id != null">
                    WHERE DISTRICT_ID = #{district_id}
                </if>
                )
            </if>
            <if test="district_id != zone_id">
                AND BUILDING.ZONE_ID = #{zone_id}
            </if>
        </where>
        ;
    </select>
</mapper>