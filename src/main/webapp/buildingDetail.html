<html lang="zh">
<head>
    <meta charset="UTF-8">
    <meta name="keywords" content="{building},{building}写字楼,{building}租金,{building}图片,{building}停车费,{building}物业费,{building}电话,{building}地址,{building}办公室出租信息,橙办网"/>
    <meta name="description" content="{building}写字楼楼盘介绍，租金价格，{building}写字楼图片，交通路线，地理位置，租赁详情，停车费，物业费，{building}写字楼出租，{city}橙办网专业写字楼租赁，办公选址专家">
    <title>{building}写字楼出租 | {building}租赁信息-{city}橙办网</title>
    <link rel="stylesheet" type="text/css" href="css/swiper.min.css"/>
    <link rel="stylesheet" type="text/css" href="layUI/css/layui.css">
    <link rel="stylesheet" type="text/css" href="css/all.css"/>
    <link rel="stylesheet" type="text/css" href="css/buildingDetail.css"/>
    <!--引用百度地图API-->
    <script src="js/jquery-1.12.0.min.js" type="text/javascript" charset="utf-8"></script>
    <script src="js/swiper.jquery.min.js" type="text/javascript" charset="utf-8"></script>
    <script src="layUI/layui.js" type="text/javascript" charset="utf-8"></script>
    <script type="text/javascript"
            src="http://api.map.baidu.com/api?v=2.0&ak=GE9frXl5g9FxrMuggC5iN3Ay4ZKHW5Hk"></script>
    <script src="js/map.js" type="text/javascript" charset="utf-8"></script>
    <script src="js/utils.js" type="text/javascript" charset="utf-8"></script>
</head>

<script type="text/javascript">
    'use strict';
    setCity();
</script>

<body>
<div class="title_box">
    <div class="win flex_row position_relative">
        <div class="top_logo"></div>

        <div class="city-pull-down fl city-pull-down-border">
            <span class="city-pull-down-bg inline-block">
                <i class="txt">上海</i>
                <div class="city-toggle-icon"></div>
            </span>
            <div class="city-select">
                <div class="header-current-city">
                    上海
                    <div class="city-toggle-icon"></div>
                </div>
                <div class="clearfix header-city-box">
                    <div class="header-tips">城市</div>
                    <div class="header-city-list clearfix">
                        <a href="http://www.orangeban.com/bj" class="fl header-city-item ">北京</a>
                        <a href="http://www.orangeban.com/sh"
                           class="fl header-city-item header-city-item-selected">上海</a>
                        <a href="http://www.orangeban.com/hz" class="fl header-city-item ">杭州</a>
                        <a href="http://www.orangeban.com/nb" class="fl header-city-item ">宁波</a>
                        <a href="http://www.orangeban.com/nj" class="fl header-city-item ">南京</a>
                        <a href="http://www.orangeban.com/sz" class="fl header-city-item ">苏州</a>
                        <a href="http://www.orangeban.com/hf" class="fl header-city-item ">合肥</a>
                    </div>
                    <div class="header-city-box-footer"></div>
                </div>
            </div>
        </div>

        <script>
            $(".city-pull-down").click(function () {
                $('.city-pull-down .arrow-icon').toggle();
                $(".city-pull-down .city-select").stop(true).slideToggle();
            });
        </script>

        <div class="position_right">
            <div class="title_text_right">
                <a href="index.html" class="clickable">首页</a>
            </div>
            <div class="title_text_right title_obvious">
                <a href="search.html" class="clickable">写字楼出租</a>
            </div>
            <div class="title_text_right">
                <a href="search.html?type_id=3" class="clickable">共享办公</a>
            </div>
            <div class="title_text_right">
                <a href="news.html" class="clickable">资讯中心</a>
            </div>
            <div class="icon_phone"></div>
            <div class="title_text_right">
                <span class="tel_num">4008-700-758</span>
            </div>
        </div>
    </div>
</div>

<div class="title_box" id="top_search_box_none" style="display: none;"></div>

<div class="top_info_box">
    <div class="top_info">
        <div class="flex_column_left top_info_title_box">
            <div class="flex_row_left">
                <div class="detail_info_name" id="building_name"></div>
                <div class="detail_info_price_box">
                    <span class="detail_info_price price_color" id="detail_info_price">0</span>元/m²/天
                </div>
            </div>
            <div class="flex_row_left" style="font-size: 12px;color: #666;">
                <i class="layui-icon layui-icon-location" style="font-size: 16px;"></i>
                <span id="district_name" class="clickable address_clickable"></span> -
                <span id="zone_name" class="clickable address_clickable"></span>
            </div>
        </div>
    </div>

    <div class="swiper-container swiper_top_info" id="swiper_top_info">
        <div class="swiper-wrapper" id="top_image_list">
        </div>
        <div class="swiper_position swiper_top"></div>

        <!-- 信息 -->
        <div class="office_info_number_box">
            <div class="office_info_in_top">
                <span id="office_number" class="detail_info_price price_color">35</span>套在租房源
            </div>
            <div class="office_info_in_top">
                可租面积：<span id="office_size" class="detail_info_price price_color">35</span>m²
            </div>
        </div>

        <!-- 咨询预约 -->
        <div class="ready_box_in_top flex_row">
            <div class="flex_row">
                <div>
                    免费咨询：
                </div><span class="price_color">400-8700-758</span>
            </div>
            <div class="flex_row">
                <div>
                    立即预约
                </div>
                <input class="layui-input ready_input" placeholder="请输入手机号" />
                <div class="ready_submit">→</div>
            </div>
        </div>
    </div>
</div>

<div class="content_box matop win flex_row">
    <div class="content_left">
        <div class="bg_white left_item">
            <h3 class="sec_title">出租房源</h3>

            <div class="condition_line flex_row" id="type" style="display: none;">
                <div class="condition_title">
                    类型：
                </div>
                <div class="option_box flex_row" id="typeList" style="display: none;">
                </div>
            </div>

            <div class="condition_line flex_row" id="areaRange" style="display: none;">
                <div class="condition_title">
                    面积：
                </div>
                <div class="option_box flex_row" id="areaRangeList" style="display: none;">
                </div>
            </div>

            <div class="condition_line flex_row" id="priceRange" style="display: none;">
                <div class="condition_title">
                    价格：
                </div>
                <div class="option_box flex_row" id="priceRangeList" style="display: none;">
                </div>
            </div>

            <div class="condition_line flex_row" id="decoration" style="display: none;">
                <div class="condition_title">
                    装修：
                </div>
                <div class="option_box flex_row" id="decorationList" style="display: none;">
                </div>
            </div>

            <div class="data_list">
                <div class="data_item_box flex_row" id="dataList">
                </div>
            </div>

            <table class="table_box" id="data_item_box">
                <tr class="table_title">
                    <td>照片</td>
                    <!--<td>房源信息</td>-->
                    <td>面积</td>
                    <td>单价</td>
                    <td>总价</td>
                </tr>
            </table>

            <div class="flex_row">

                <div class="paging" id="next_page">
                </div>
            </div>
        </div>

        <div class="bg_white left_item matop">
            <h3 class="sec_title">楼盘信息</h3>
            <div class="data_list">
                <div class="data_item_box flex_row">
                    <div class="bottom_info_box flex_row" id="bottom_info">
                    </div>
                </div>
            </div>
            <h3 class="sec_title matop">楼盘简介</h3>
            <div class="introduce_info" id="introduce_info">

            </div>
        </div>

        <div class="img_map_box left_item ">
            <div class="map_box">
                <div style="width:100%;height:100%;margin: 0 auto;font-size:12px" id="map"></div>
            </div>
        </div>
    </div>

    <div class="content_right bg_white" id="position_fixed">
        <form action="search.html">
            <div class="right_search_box">
                <input type="text" id="keyword_input" class="right_search" name="keyword" placeholder="在这里输入您想了解的写字楼"/>
                <input class="right_search_btn" type="submit" value=" "/>
            </div>
        </form>

        <!--        <div class="right_item_box">-->
        <!--            <div class="right_item_title_red">热门写字楼</div>-->
        <!--            <div class="flex_column_left" id="right_heat_building">-->
        <!--            </div>-->
        <!--        </div>-->

        <div class="right_item_box">
            <div class="right_item_title_orange">近期资讯</div>
            <div class="flex_column_left" id="right_heat_news">
            </div>
        </div>
    </div>
</div>

<div class="bottom_box flex_column_left">
    <div class="win flex_column_left">
        <span class="friendly_href_sign">&nbsp;|&nbsp;&nbsp;&nbsp;友情链接</span>

        <div class="friendly_href">
            <a href="https://sh.diandianzu.com/" target="_blank">上海办公室出租</a>
            <a href="https://sh.diandianzu.com/" target="_blank">上海办公室出租</a>
            <a href="https://sh.diandianzu.com/" target="_blank">上海办公室出租</a>
        </div>

        <div class="foot_logo flex_row">
            <div class="bottom_logo"></div>
            <span>&nbsp;&nbsp;&nbsp;办公选址 心想事成！</span>
        </div>

        <div class="foot_contact_info flex_column_left">
            <span>24h 400电话：400-8700-758</span>
        </div>
    </div>
</div>
</body>

<!-- 美洽客服 -->
<script title="text/javascript">
    'use strict';

    (function (m, ei, q, i, a, j, s) {
        m[i] = m[i] || function () {
            (m[i].a = m[i].a || []).push(arguments)
        };
        j = ei.createElement(q);
        s = ei.getElementsByTagName(q)[0];
        j.async = true;
        j.charset = 'UTF-8';
        j.src = 'https://static.meiqia.com/dist/meiqia.js?=_t';
        s.parentNode.insertBefore(j, s);
    })(window, document, 'script', '_MEIQIA');
    _MEIQIA('entId', 51778);
</script>

<script type="text/javascript">
    'use strict';

    let building_id;
    let building;
    let filter = {};
    let pageIndex = 0;
    let pageNum = 0;

    window.onload = function () {
        let request = window.location.search;
        building_id = http.getParameter(request, "building_id");
        filter.checkedTypeId = http.getParameter(request, "type_id");
        filter.checkedAreaRangeId = http.getParameter(request, "area_range_id");
        filter.checkedPriceRangeId = http.getParameter(request, "price_range_id");
        filter.checkedDecorationId = http.getParameter(request, "decoration_id");
        getFilterList();
        getBuilding();
        getHotList();

        initMap();

        setFixed();
    };

    function setFixed() {
        let fixedView = document.getElementById("position_fixed");
        let fixedTop = window.scrollY + fixedView.getBoundingClientRect().y;
        let fixedLeft = fixedView.getBoundingClientRect().x;
        fixedView.setAttribute("style", "left: " + fixedLeft + "px;");
        let bottomBox = document.getElementsByClassName("bottom_box")[0];

        // 解决在页面中部时刷新页面浮动问题
        setFixedPosition(bottomBox, fixedView, fixedTop);
        window.onscroll = function () {
            setFixedPosition(bottomBox, fixedView, fixedTop);
        }
    }

    function setFixedPosition(bottomBox, fixedView, fixedTop) {
        let toBottomHeight = 5;
        if (window.scrollY <= (fixedTop - 100)) {
            fixedView.setAttribute("class", "content_right bg_white");
        } else if (bottomBox.getBoundingClientRect().top < 100 + toBottomHeight + fixedView.getBoundingClientRect().height) {
            fixedView.setAttribute("class", "content_right bg_white position_fixed_bottom");
            fixedView.style.bottom = (window.innerHeight - bottomBox.getBoundingClientRect().top + toBottomHeight) + "px";
        } else {
            fixedView.setAttribute("class", "content_right bg_white position_fixed");
        }
    }


    function getFilterList() {
        http.post({
            url: "filter/office",
            params: {
                building_id: building_id,
                type_id: filter.checkedTypeId,
                area_range_id: filter.checkedAreaRangeId,
                price_range_id: filter.checkedPriceRangeId,
                decoration_id: filter.checkedDecorationId,
            },
            success: function (data) {
                filter = data;
                getOfficeList();
            }
        });
    }

    function getBuilding() {
        http.post({
            url: "search/building",
            params: {
                id: building_id,
            },
            success: function (data) {
                building = data;

                setBuilding(building.name);
                setTopInfo(building);
                setBottomInfo(building);
                let notes = JSON.parse(building.notes);
                if (notes && notes.map) {
                    setMarkers(notes.map);
                }
            }
        });
    }

    function getOfficeList(page) {
        http.post({
            url: "search/offices",
            params: {
                building_id: building_id,
                type_id: filter.checkedTypeId,
                area_range_id: filter.checkedAreaRangeId,
                price_range_id: filter.checkedPriceRangeId,
                decoration_id: filter.checkedDecorationId,
                page: page,
            },
            success: function (data) {
                filter.checkedTypeId = data.checkedTypeId;
                filter.checkedAreaRangeId = data.checkedAreaRangeId;
                filter.checkedPriceRangeId = data.checkedPriceRangeId;
                filter.checkedDecorationId = data.checkedDecorationId;
                setFilterList();
                pageIndex = data.pageIndex;
                pageNum = data.pageNum;
                setOfficeList(data.officeList);
                loadPageUtil(pageNum * 10);
            }
        });
    }

    function setFilterList() {
        if (!filter) {
            return;
        }
        setFilterListByName(filter.typeList, 'typeList', filter.checkedTypeId);
        setFilterListByName(filter.areaRangeList, 'areaRangeList', filter.checkedAreaRangeId);
        setFilterListByName(filter.priceRangeList, 'priceRangeList', filter.checkedPriceRangeId);
        setFilterListByName(filter.decorationList, 'decorationList', filter.checkedDecorationId);
    }

    function setFilterListByName(list, name, checkedId) {
        if (!list || list.length <= 2) {
            $("#" + name.substr(0, name.length - 4)).hide();
        } else {
            $("#" + name.substr(0, name.length - 4)).show();
        }
        let conditionBox = document.getElementById(name);
        conditionBox.innerHTML = "";
        for (let i = 0; list && i < list.length; i++) {
            let optionItem = document.createElement("span");
            if (list[i].id === checkedId) {
                optionItem.className = 'condition_option_select';
            } else {
                optionItem.className = 'condition_option';
            }
            optionItem.innerHTML = list[i].name;
            optionItem.onclick = function () {
                switch (name) {
                    case "typeList":
                        filter.checkedTypeId = list[i].id;
                        break;
                    case "areaRangeList":
                        filter.checkedAreaRangeId = list[i].id;
                        break;
                    case "priceRangeList":
                        filter.checkedPriceRangeId = list[i].id;
                        break;
                    case "decorationList":
                        filter.checkedDecorationId = list[i].id;
                        break;
                }
                getOfficeList();
            };
            conditionBox.appendChild(optionItem);
        }
    }

    /**
     * 设置顶部数据
     * @param building 数据
     */
    function setTopInfo(building) {
        // 名字
        document.getElementById("building_name").innerHTML = building.name;
        // 图片
        let imgBox = document.getElementById("top_image_list");
        let img_list = utils.getImg_list(building);
        for (let img of img_list) {
            let itemBox = document.createElement("div");
            itemBox.setAttribute("class", "swiper-slide");
            imgBox.appendChild(itemBox);
            let itemImg = document.createElement("img");
            itemImg.setAttribute("class", "top_info_image");
            itemImg.setAttribute("src", img);
            itemImg.setAttribute("alt", building.name);
            itemBox.appendChild(itemImg);
        }
        if (img_list && img_list.length > 1) {
            openSwiper();
        }
        // 价格范围
        document.getElementById("detail_info_price").innerHTML = building.price_range;
        // 联系客服顶部价格
        // document.getElementById("service_info_price").innerHTML = building.price_range;
        // 地址
        let district_name = document.getElementById("district_name");
        district_name.innerHTML = building.district_name;
        district_name.onclick = function () {
            window.open("search.html?district_id=" + building.district_id, "_blank");
        };
        let zone_name = document.getElementById("zone_name");
        zone_name.innerHTML = building.zone_name;
        zone_name.onclick = function () {
            window.open("search.html?district_id=" + building.district_id
                + "&zone_id=" + building.zone_id, "_blank");
        };
    }

    /**
     * 设置办公室列表数据
     */
    function setOfficeList(officeList) {
        let contentBox = document.getElementById("data_item_box");
        if (pageIndex === 0) {
            // 清除子view
            let childList = contentBox.childNodes;
            while (childList.length > 2) {
                contentBox.removeChild(childList[2]);
            }
        }
        if (pageNum > pageIndex + 1) {
            $("#next_page").show();
        } else {
            $("#next_page").hide();
        }
        // if (pageIndex === 0 && buildingList.length === 0) {
        //     $("#error_not_text").show();
        // } else {
        //     $("#error_not_text").hide();
        // }

        for (let office of officeList) {
            let trView = document.createElement("tr");
            contentBox.appendChild(trView);
            let tdImage = document.createElement("td");
            trView.appendChild(tdImage);

            // 图片
            let imageView = document.createElement("img");
            imageView.className = "table_item_image clickable";
            utils.setImage(imageView, office.img_list, building.name);
            tdImage.onclick = function () {
                openRoomDetail(office.id);
            };
            tdImage.appendChild(imageView);

            // 房源信息
            // let sourceInfo = document.createElement("td");
            // sourceInfo.setAttribute("class", "source_info_td");
            // sourceInfo.innerHTML = "<div class='clickable'>" + office.source_info + "</div>";
            // sourceInfo.onclick = function () {
            //     openRoomDetail(office.id);
            // };
            // trView.appendChild(sourceInfo);

            // 面积
            let area = document.createElement("td");
            let areaName = document.createElement("span");
            areaName.innerHTML = office.area;
            areaName.setAttribute("class", "big_text");
            let areaEnd = document.createElement("span");
            areaEnd.innerHTML = "m²";
            area.appendChild(areaName);
            area.appendChild(areaEnd);
            trView.appendChild(area);

            // 单价
            let price = document.createElement("td");
            let priceName = document.createElement("span");
            priceName.innerHTML = office.price;
            priceName.setAttribute("class", "big_text price_color");
            let priceEnd = document.createElement("span");
            priceEnd.innerHTML = "元/m²/天";
            price.appendChild(priceName);
            price.appendChild(priceEnd);
            trView.appendChild(price);

            // 总价
            let totalPrice = document.createElement("td");
            let totalPriceName = document.createElement("span");
            totalPriceName.innerHTML = office.total_price;
            totalPriceName.setAttribute("class", "big_text  price_color");
            let totalPriceEnd = document.createElement("span");
            totalPriceEnd.innerHTML = "元/月";
            totalPrice.appendChild(totalPriceName);
            totalPrice.appendChild(totalPriceEnd);
            trView.appendChild(totalPrice);
        }
    }

    /**
     * 设置底部写字楼信息
     */
    function setBottomInfo(building) {
        let notes = JSON.parse(building.notes);
        let detail_info = notes.detail_info;
        let bottom_info = document.getElementById("bottom_info");
        bottom_info.innerHTML = "";
        if (!detail_info || detail_info.length === 0) {
            $("#bottom_info").hide();
        } else {
            $("#bottom_info").show();
        }
        for (let info of detail_info) {
            let box = document.createElement("div");
            box.className = "bottom_info_item flex_row";

            let key = document.createElement("div");
            key.className = "bottom_info_title";
            key.innerHTML = info.key + ":";

            let value = document.createElement("div");
            value.className = "bottom_info_text";
            value.innerHTML = info.value;

            box.appendChild(key);
            box.appendChild(value);
            bottom_info.appendChild(box);
        }

        document.getElementById("introduce_info").innerHTML = building.introduce;
    }

    function nextPage() {
        getOfficeList(pageIndex + 1);
    }

    function openRoomDetail(office_id) {
        window.open("officeDetail.html?office_id=" + office_id, "_blank");
    }

    function openSwiper() {
        new Swiper('#swiper_top_info', {
            loop: true,
            autoplay: 2000,
            pagination: '.swiper_position',
            paginationClickable: true,
            autoplayDisableOnInteraction: false,
        });
    }

    function getHotList() {
        http.post({
            url: "news/hot",
            success: function (data) {
                setHeatNews(data);
            }
        })
    }

    /**
     * 设置资讯
     * @param heatNewsList
     */
    function setHeatNews(heatNewsList) {
        if (heatNewsList == null) return;
        let ListBox = document.getElementById("right_heat_news");
        for (let i = 0, len = heatNewsList.length; i < len; i++) {
            let itemBox = document.createElement("div");
            itemBox.className = "right_heat_news_item";

            let imgListStr = heatNewsList[i].img_list;
            let imgList = JSON.parse(imgListStr);
            let itemImg = document.createElement("img");
            itemImg.className = "right_heat_news_img";
            if (imgList && imgList.length > 0) {
                utils.setImageSrc(itemImg, imgList[0]);
            } else {
                utils.setImageSrc(itemImg, null);
            }
            itemBox.appendChild(itemImg);

            let itemInfo = document.createElement("div");
            itemInfo.className = "right_heat_news flex_column_left";

            let itemTitle = document.createElement("div");
            itemTitle.className = "right_heat_news_title";
            itemTitle.innerHTML = heatNewsList[i].title;
            itemTitle.onclick = function () {
                window.open("newsDetail.html?news_id=" + heatNewsList[i].id);
            };
            itemInfo.appendChild(itemTitle);

            let itemTime = document.createElement("div");
            itemTime.className = "right_heat_news_time";
            itemTime.innerHTML = heatNewsList[i].last_edit_time;
            itemInfo.appendChild(itemTime);

            if (i === len - 1) {
                itemBox.setAttribute("style", "border: none;");
            }

            itemBox.appendChild(itemInfo);
            ListBox.appendChild(itemBox);
        }
    }


    /**
     * 加载分页工具
     * @param dataSize 数据总数
     */
    function loadPageUtil(dataSize) {
        layui.use('laypage', function () {
            var laypage = layui.laypage;
            //执行一个laypage实例
            laypage.render({
                //注意，这里的 test1 是 ID，不用加 # 号
                elem: 'page_box',
                //数据总数，从服务端得到
                count: dataSize,
                limit: 10,
                jump: function (obj, first) {
                    //obj包含了当前分页的所有参数，比如：
                    // console.log(obj.curr); //得到当前页，以便向服务端请求对应页的数据。
                    // console.log(obj.limit); //得到每页显示的条数

                    //首次不执行
                    if (!first) {
                        getOfficeList(obj.curr - 1);
                    }
                }
            });
        });
    }

</script>
</html>